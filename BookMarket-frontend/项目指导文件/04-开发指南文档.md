# 书市项目开发指南文档

## 1. 开发环境配置

### 1.1 环境要求

#### 1.1.1 必需软件
- **Node.js**：v18.0.0 或更高版本（推荐 v18.17.0 LTS）
- **npm**：v9.0.0 或更高版本（随Node.js安装）
- **Git**：v2.30.0 或更高版本
- **VS Code**：推荐使用 VS Code 作为开发工具

#### 1.1.2 推荐插件
- ESLint
- Prettier
- Volar (Vue 3)
- Tailwind CSS IntelliSense
- Path Intellisense
- Auto Rename Tag
- Bracket Pair Colorizer

### 1.2 项目初始化

#### 1.2.1 克隆项目
```bash
# 克隆项目仓库
git clone <repository-url>
cd BookMarket-frontend
```

#### 1.2.2 安装依赖
```bash
# 使用npm安装依赖
npm install

# 或使用yarn
yarn install

# 或使用pnpm
pnpm install
```

#### 1.2.3 启动开发服务器
```bash
# 启动开发服务器
npm run dev

# 或
yarn dev

# 或
pnpm dev
```

开发服务器将在 `http://localhost:5173` 启动。

### 1.3 环境变量配置

#### 1.3.1 环境变量文件
项目包含以下环境变量文件：

- `.env`：通用环境变量
- `.env.development`：开发环境变量
- `.env.production`：生产环境变量

#### 1.3.2 环境变量示例

```bash
# .env.development
VITE_APP_TITLE=书市
VITE_API_BASE_URL=http://localhost:3000/api
VITE_UPLOAD_URL=http://localhost:3000/upload
VITE_APP_ENV=development
```

```bash
# .env.production
VITE_APP_TITLE=书市
VITE_API_BASE_URL=https://api.bookmarket.com/api
VITE_UPLOAD_URL=https://api.bookmarket.com/upload
VITE_APP_ENV=production
```

### 1.4 开发/生产环境配置

#### 1.4.1 开发环境
```bash
# 启动开发服务器
npm run dev

# 开发环境特点：
# - 热模块替换（HMR）
# - 详细的错误信息
# - Source Map
# - 开发工具支持
```

#### 1.4.2 生产环境
```bash
# 构建生产版本
npm run build

# 预览生产构建
npm run preview

# 生产环境特点：
# - 代码压缩
# - Tree Shaking
# - 代码分割
# - 资源优化
```

---

## 2. 编码规范

### 2.1 ESLint规则

#### 2.1.1 ESLint配置
```javascript
// .eslintrc.js
module.exports = {
  root: true,
  env: {
    node: true,
    browser: true,
    es2021: true
  },
  extends: [
    'plugin:vue/vue3-recommended',
    'plugin:@typescript-eslint/recommended',
    'prettier'
  ],
  parser: 'vue-eslint-parser',
  parserOptions: {
    parser: '@typescript-eslint/parser',
    ecmaVersion: 2021,
    sourceType: 'module'
  },
  plugins: ['vue', '@typescript-eslint'],
  rules: {
    'vue/multi-word-component-names': 'off',
    'vue/no-v-html': 'warn',
    '@typescript-eslint/no-explicit-any': 'warn',
    '@typescript-eslint/no-unused-vars': ['warn', { argsIgnorePattern: '^_' }],
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off'
  }
}
```

#### 2.1.2 常用ESLint规则
- `vue/multi-word-component-names`：关闭多单词组件名检查
- `vue/no-v-html`：警告使用v-html
- `@typescript-eslint/no-explicit-any`：警告使用any类型
- `@typescript-eslint/no-unused-vars`：警告未使用的变量
- `no-console`：生产环境警告使用console

### 2.2 Prettier规则

#### 2.2.1 Prettier配置
```javascript
// .prettierrc.js
module.exports = {
  semi: false,
  singleQuote: true,
  printWidth: 100,
  tabWidth: 2,
  trailingComma: 'none',
  arrowParens: 'avoid',
  endOfLine: 'lf',
  vueIndentScriptAndStyle: false
}
```

#### 2.2.2 Prettier规则说明
- `semi`：不使用分号
- `singleQuote`：使用单引号
- `printWidth`：每行最大100字符
- `tabWidth`：缩进2个空格
- `trailingComma`：不使用尾随逗号
- `arrowParens`：箭头函数单参数时不加括号
- `endOfLine`：使用LF换行符
- `vueIndentScriptAndStyle`：Vue文件中script和style不缩进

### 2.3 代码风格指南

#### 2.3.1 Vue组件风格

**使用Composition API + `<script setup>`**
```vue
<template>
  <div class="book-card">
    <h1>{{ title }}</h1>
    <button @click="handleClick">Click</button>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'

const props = defineProps({
  title: {
    type: String,
    required: true
  }
})

const emit = defineEmits(['click'])

const count = ref(0)
const doubled = computed(() => count.value * 2)

function handleClick() {
  count.value++
  emit('click', count.value)
}
</script>

<style scoped>
.book-card {
  padding: 1rem;
}
</style>
```

#### 2.3.2 命名规范

**文件命名**
- 组件文件：PascalCase（如 `BookCard.vue`）
- 工具文件：kebab-case（如 `format.js`）
- 类型文件：PascalCase（如 `Book.ts`）

**变量命名**
- 变量/函数：camelCase（如 `fetchBooks`）
- 常量：UPPER_SNAKE_CASE（如 `API_BASE_URL`）
- 类/接口：PascalCase（如 `BookService`）
- 私有变量：前缀下划线（如 `_internalState`）

**组件命名**
- 组件名：PascalCase（如 `BookCard`）
- 组件文件名：与组件名一致（如 `BookCard.vue`）

#### 2.3.3 注释规范

**单行注释**
```javascript
// 计算总价
const total = computed(() => items.reduce((sum, item) => sum + item.price, 0))
```

**多行注释**
```javascript
/**
 * 获取书籍列表
 * @param {Object} params - 查询参数
 * @param {number} params.page - 页码
 * @param {number} params.pageSize - 每页数量
 * @returns {Promise<Array>} 书籍列表
 */
async function fetchBooks(params) {
  // ...
}
```

**JSDoc注释**
```javascript
/**
 * 格式化价格
 * @param {number} price - 价格
 * @returns {string} 格式化后的价格
 */
export function formatPrice(price) {
  return `¥${price.toFixed(2)}`
}
```

#### 2.3.4 代码组织

**导入顺序**
```javascript
// 1. Vue相关
import { ref, computed, onMounted } from 'vue'
import { useRouter, useRoute } from 'vue-router'

// 2. 第三方库
import axios from 'axios'
import dayjs from 'dayjs'

// 3. 组件
import BookCard from '@/components/book/BookCard.vue'

// 4. Store
import { useAuthStore } from '@/store/modules/auth'

// 5. API
import { fetchBooks } from '@/api/book'

// 6. Utils
import { formatPrice } from '@/utils/format'

// 7. Types
import type { Book } from '@/types/book'
```

**组件结构**
```vue
<template>
  <!-- 模板 -->
</template>

<script setup>
// 1. 导入
import { ref, computed } from 'vue'

// 2. Props
const props = defineProps({
  // ...
})

// 3. Emits
const emit = defineEmits(['update:modelValue'])

// 4. 响应式数据
const count = ref(0)

// 5. 计算属性
const doubled = computed(() => count.value * 2)

// 6. 方法
function handleClick() {
  // ...
}

// 7. 生命周期
onMounted(() => {
  // ...
})
</script>

<style scoped>
/* 样式 */
</style>
```

### 2.4 TypeScript规范

#### 2.4.1 类型定义
```typescript
// types/book.ts
export interface Book {
  id: number
  title: string
  author: string
  isbn?: string
  publisher?: string
  publishDate?: string
  category: string
  condition: BookCondition
  price: number
  originalPrice?: number
  stock: number
  cover: string
  images: string[]
  description: string
  sellerId: number
  sellerName: string
  createdAt: string
  updatedAt: string
}

export type BookCondition = 'new' | '90' | '80' | '70' | '60'

export interface BookFilters {
  category?: string
  priceRange?: [number, number]
  condition?: BookCondition
  keyword?: string
}
```

#### 2.4.2 类型使用
```typescript
import type { Book, BookFilters } from '@/types/book'

const books = ref<Book[]>([])
const filters = ref<BookFilters>({
  category: 'tech',
  priceRange: [0, 100]
})

async function fetchBooks(filters: BookFilters): Promise<Book[]> {
  const response = await api.get<Book[]>('/books', { params: filters })
  return response.data
}
```

---

## 3. 提交规范

### 3.1 Git提交信息格式

#### 3.1.1 提交信息格式
```
<type>(<scope>): <subject>

<body>

<footer>
```

#### 3.1.2 Type类型
- `feat`：新功能
- `fix`：修复bug
- `docs`：文档更新
- `style`：代码格式调整（不影响代码运行）
- `refactor`：重构（既不是新增功能，也不是修复bug）
- `perf`：性能优化
- `test`：测试相关
- `chore`：构建过程或辅助工具的变动
- `revert`：回滚之前的commit

#### 3.1.3 Scope范围
- `auth`：认证相关
- `user`：用户相关
- `book`：书籍相关
- `cart`：购物车相关
- `order`：订单相关
- `seller`：卖家相关
- `ui`：UI组件
- `api`：API接口
- `utils`：工具函数
- `config`：配置文件

#### 3.1.4 提交信息示例
```bash
# 新功能
feat(book): 添加书籍列表筛选功能

# 修复bug
fix(cart): 修复购物车数量计算错误

# 文档更新
docs(readme): 更新项目说明文档

# 代码格式
style(ui): 统一按钮组件样式

# 重构
refactor(api): 重构API请求封装

# 性能优化
perf(list): 优化书籍列表渲染性能

# 测试
test(auth): 添加登录表单测试

# 构建
chore(deps): 升级依赖包版本
```

### 3.2 分支管理策略

#### 3.2.1 分支类型
- `main`：主分支，用于生产环境
- `develop`：开发分支，用于集成开发
- `feature/*`：功能分支，用于开发新功能
- `bugfix/*`：修复分支，用于修复bug
- `hotfix/*`：紧急修复分支，用于生产环境紧急修复
- `release/*`：发布分支，用于版本发布

#### 3.2.2 分支命名规范
```bash
# 功能分支
feature/user-authentication
feature/book-list-filter
feature/shopping-cart

# 修复分支
bugfix/cart-calculation-error
bugfix/login-validation

# 紧急修复分支
hotfix/payment-gateway-issue

# 发布分支
release/v1.0.0
release/v1.1.0
```

#### 3.2.3 分支工作流

**功能开发流程**
```bash
# 1. 从develop创建功能分支
git checkout develop
git pull origin develop
git checkout -b feature/user-authentication

# 2. 开发功能
# ... 编写代码 ...

# 3. 提交代码
git add .
git commit -m "feat(auth): 添加用户认证功能"

# 4. 推送到远程
git push origin feature/user-authentication

# 5. 创建Pull Request
# 在GitHub/GitLab上创建PR到develop分支

# 6. 代码审查通过后合并
# 合并到develop分支后删除功能分支
```

**修复bug流程**
```bash
# 1. 从develop创建修复分支
git checkout develop
git pull origin develop
git checkout -b bugfix/cart-calculation-error

# 2. 修复bug
# ... 修复代码 ...

# 3. 提交代码
git add .
git commit -m "fix(cart): 修复购物车数量计算错误"

# 4. 推送到远程
git push origin bugfix/cart-calculation-error

# 5. 创建Pull Request
# 在GitHub/GitLab上创建PR到develop分支

# 6. 代码审查通过后合并
```

**发布流程**
```bash
# 1. 从develop创建发布分支
git checkout develop
git pull origin develop
git checkout -b release/v1.0.0

# 2. 准备发布
# 更新版本号、更新文档等

# 3. 提交代码
git add .
git commit -m "chore(release): 准备v1.0.0版本发布"

# 4. 合并到main和develop
git checkout main
git merge release/v1.0.0
git tag v1.0.0
git push origin main --tags

git checkout develop
git merge release/v1.0.0
git push origin develop

# 5. 删除发布分支
git branch -d release/v1.0.0
git push origin --delete release/v1.0.0
```

### 3.3 代码审查规范

#### 3.3.1 代码审查清单
- [ ] 代码符合项目编码规范
- [ ] 代码有适当的注释
- [ ] 代码有适当的错误处理
- [ ] 代码有适当的测试
- [ ] 代码没有引入新的bug
- [ ] 代码没有引入安全漏洞
- [ ] 代码性能良好
- [ ] 代码可读性好
- [ ] 代码可维护性好

#### 3.3.2 代码审查流程
1. 创建Pull Request
2. 指定审查人员
3. 审查人员审查代码
4. 提出修改意见
5. 开发人员修改代码
6. 审查通过后合并

---

## 4. 开发流程

### 4.1 需求确认

#### 4.1.1 需求分析
- 阅读需求文档
- 理解功能需求
- 理解技术需求
- 确认设计规范

#### 4.1.2 技术调研
- 调研相关技术
- 评估技术可行性
- 确定技术方案
- 编写技术方案文档

### 4.2 任务分配

#### 4.2.1 任务拆分
- 将需求拆分为具体任务
- 估算任务工作量
- 确定任务优先级
- 分配任务给开发人员

#### 4.2.2 任务跟踪
- 使用项目管理工具（如Jira、Trello）
- 跟踪任务进度
- 及时更新任务状态
- 协调任务依赖

### 4.3 开发实施

#### 4.3.1 开发流程
1. 创建功能分支
2. 编写代码
3. 编写测试
4. 本地测试
5. 提交代码
6. 创建Pull Request
7. 代码审查
8. 合并代码

#### 4.3.2 开发规范
- 遵循编码规范
- 遵循设计规范
- 编写清晰的代码
- 编写适当的注释
- 编写单元测试

### 4.4 代码审查

#### 4.4.1 审查准备
- 确保代码可以运行
- 确保代码有测试
- 确保代码有文档
- 确保代码符合规范

#### 4.4.2 审查要点
- 功能正确性
- 代码质量
- 性能优化
- 安全性
- 可维护性

### 4.5 测试验证

#### 4.5.1 测试类型
- **单元测试**：测试单个函数/组件
- **集成测试**：测试多个组件的集成
- **E2E测试**：测试完整的用户流程

#### 4.5.2 测试工具
- **单元测试**：Vitest
- **组件测试**：Vue Test Utils
- **E2E测试**：Cypress / Playwright

#### 4.5.3 测试命令
```bash
# 运行所有测试
npm run test

# 运行单元测试
npm run test:unit

# 运行E2E测试
npm run test:e2e

# 生成测试覆盖率报告
npm run test:coverage
```

#### 4.5.4 测试覆盖率
- 单元测试覆盖率 > 80%
- 核心功能测试覆盖率 100%
- 关键用户路径E2E测试

---

## 5. 常用命令

### 5.1 开发命令
```bash
# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 预览生产构建
npm run preview

# 代码检查
npm run lint

# 代码格式化
npm run format

# 类型检查
npm run type-check
```

### 5.2 测试命令
```bash
# 运行所有测试
npm run test

# 运行单元测试
npm run test:unit

# 运行E2E测试
npm run test:e2e

# 生成测试覆盖率报告
npm run test:coverage
```

### 5.3 Git命令
```bash
# 查看状态
git status

# 添加文件
git add .

# 提交代码
git commit -m "feat: 添加新功能"

# 推送到远程
git push origin feature-branch

# 拉取最新代码
git pull origin develop

# 合并分支
git merge feature-branch

# 删除分支
git branch -d feature-branch
```

### 5.4 依赖管理
```bash
# 安装依赖
npm install

# 安装新依赖
npm install package-name

# 安装开发依赖
npm install package-name --save-dev

# 更新依赖
npm update

# 删除依赖
npm uninstall package-name
```

---

## 6. 常见问题

### 6.1 开发环境问题

#### Q1: 端口被占用怎么办？
```bash
# 修改vite.config.js中的端口配置
export default defineConfig({
  server: {
    port: 3000 // 修改为其他端口
  }
})
```

#### Q2: 依赖安装失败怎么办？
```bash
# 清除缓存重新安装
rm -rf node_modules package-lock.json
npm install

# 或使用淘宝镜像
npm install --registry=https://registry.npmmirror.com
```

#### Q3: 热更新不生效怎么办？
```bash
# 重启开发服务器
# 检查vite.config.js配置
```

### 6.2 构建问题

#### Q1: 构建失败怎么办？
```bash
# 检查TypeScript类型错误
npm run type-check

# 检查ESLint错误
npm run lint

# 查看详细错误信息
npm run build -- --mode development
```

#### Q2: 构建后页面空白怎么办？
```bash
# 检查控制台错误
# 检查路由配置
# 检查环境变量配置
```

### 6.3 代码规范问题

#### Q1: ESLint报错怎么办？
```bash
# 自动修复ESLint错误
npm run lint -- --fix

# 手动修复错误
```

#### Q2: Prettier格式化不生效怎么办？
```bash
# 检查.prettierrc.js配置
# 检查编辑器Prettier插件
```

---

## 7. 最佳实践

### 7.1 性能优化

#### 7.1.1 代码分割
```javascript
// 路由级别代码分割
const Home = () => import('@/views/Home.vue')
const Books = () => import('@/views/Books.vue')
```

#### 7.1.2 懒加载
```vue
<template>
  <img v-lazy="imageSrc" alt="书籍封面">
</template>
```

#### 7.1.3 防抖节流
```javascript
import { useDebounce } from '@/composables/useDebounce'

const debouncedSearch = useDebounce(search, 300)
```

### 7.2 安全实践

#### 7.2.1 XSS防护
```javascript
// 避免使用v-html
// 必须使用时进行过滤
import DOMPurify from 'dompurify'

const safeHtml = DOMPurify.sanitize(userInput)
```

#### 7.2.2 CSRF防护
```javascript
// 在请求头中添加CSRF Token
axios.defaults.headers.common['X-CSRF-TOKEN'] = getCsrfToken()
```

### 7.3 可维护性

#### 7.3.1 组件复用
- 提取通用组件
- 使用组合式函数
- 避免重复代码

#### 7.3.2 代码文档
- 编写清晰的注释
- 编写JSDoc注释
- 编写README文档

---

## 8. 总结

本文档详细说明了书市项目的开发环境配置、编码规范、提交规范和开发流程。开发团队应严格按照本文档进行开发，确保代码质量和项目进度。

如有任何问题，请及时与项目负责人沟通。
